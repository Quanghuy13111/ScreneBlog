{% extends 'base.html' %}
{% load blog_extras %}

{% block title %}{{ profile_user.username }}'s Profile{% endblock %}

{% block content %}
<div class="card animate-on-scroll">
    <div class="card-body text-center p-lg-5">
        <svg xmlns="http://www.w3.org/2000/svg" width="80" height="80" fill="currentColor" class="bi bi-person-circle text-body-secondary mb-3" viewBox="0 0 16 16"><path d="M11 6a3 3 0 1 1-6 0 3 3 0 0 1 6 0z"/><path fill-rule="evenodd" d="M0 8a8 8 0 1 1 16 0A8 8 0 0 1 0 8zm8-7a7 7 0 0 0-5.468 11.37C3.242 11.226 4.805 10 8 10s4.757 1.225 5.468 2.37A7 7 0 0 0 8 1z"/></svg>
        <h2 class="card-title">{{ profile_user.username }}</h2>
        <p class="text-body-secondary">Joined on {{ profile_user.date_joined|date:"F Y" }}</p>
    </div>
</div>

<h3 class="mt-5 mb-4">Posts by {{ profile_user.username }}</h3>

<div class="row row-cols-1 row-cols-md-2 row-cols-lg-3 g-4">
    {% for post in user_posts %}
        <div class="col animate-on-scroll zoom-in">
            {% if post.is_image %}
                <article class="post-card">
                    <div class="post-card-image-container">
                        <a href="{{ post.get_absolute_url }}"><img src="{{ post.thumbnail.url }}" alt="{{ post.title }}" class="card-img-top" loading="lazy"></a>
                    </div>
                    <div class="card-body">
                        <h3 class="post-title"><a href="{{ post.get_absolute_url }}">{{ post.title }}</a></h3>
                        <p class="card-text flex-grow-1 text-body-secondary mt-2">{{ post.content|striptags|truncatewords:15 }}</p>
                        <div class="post-card-author">
                            <a href="{% url 'blog:public_user_profile' post.author.username %}"><img src="{{ post.author.profile.avatar_thumbnail.url }}" alt="{{ post.author.username }}" loading="lazy"></a>
                            <div>
                                <a href="{% url 'blog:public_user_profile' post.author.username %}" class="text-decoration-none text-body fw-bold small">{{ post.author.username }}</a>
                                <div class="text-body-secondary small">{{ post.created|date:"M d, Y" }}</div>
                            </div>
                        </div>
                    </div>
                    <div class="card-footer text-body-secondary">
                        <span><i class="bi bi-heart"></i> {{ post.likes }}</span>
                        <span><i class="bi bi-chat-dots"></i> {{ post.num_comments }}</span>
                    </div>
                </article>
            {% else %}
                <article class="post-card-text-only">
                    <h3 class="post-title"><a href="{{ post.get_absolute_url }}" class="text-decoration-none text-body">{{ post.title }}</a></h3>
                    <p class="card-text flex-grow-1 text-body-secondary my-3">{{ post.content|striptags|truncatewords:25 }}</p>
                    <div class="card-footer d-flex justify-content-between align-items-center">
                        <div class="text-body-secondary small">{{ post.created|date:"M d, Y" }}</div>
                        <div class="d-flex align-items-center gap-3 text-body-secondary small">
                            <span><i class="bi bi-heart"></i> {{ post.likes }}</span>
                            <span><i class="bi bi-chat-dots"></i> {{ post.num_comments }}</span>
                        </div>
                    </div>
                </article>
            {% endif %}
        </div>
    {% empty %}
        <div class="alert alert-secondary">{{ profile_user.username }} has not published any posts yet.</div>
    {% endfor %}
</div>
{% endblock %}