{% extends 'base.html' %}
{% load blog_extras %}

{% block title %}Home{% endblock %}

{% block content %}
    <!-- Featured Post -->
    {% if featured_post %}
    <div class="card shadow-sm mb-5 animate-on-scroll">
        <div class="row g-0">
            {% if featured_post.is_image %}
            <div class="col-md-6">
                <img src="{{ featured_post.thumbnail.url }}" class="img-fluid rounded-start" alt="{{ featured_post.title }}" style="object-fit: cover; height: 100%;">
            </div>
            {% endif %}
            <div class="{% if featured_post.is_image %}col-md-6{% else %}col-md-12{% endif %} d-flex flex-column">
                <div class="card-body">
                    <h2 class="card-title h3"><a href="{% url 'blog:post_detail' featured_post.slug %}" class="text-body text-decoration-none">{{ featured_post.title }}</a></h2>
                    <p class="card-text text-body-secondary small">
                        By <strong><a href="{% url 'blog:public_user_profile' featured_post.author.username %}" class="text-body-secondary text-decoration-none">{{ featured_post.author.username }}</a></strong> &middot; {{ featured_post.created|date:"M d, Y" }} &middot; {{ featured_post.content|calculate_reading_time }} min read
                    </p>
                    <p class="card-text">{{ featured_post.content|striptags|truncatewords:30 }}</p>
                </div>
                <div class="card-footer bg-transparent border-top-0 d-flex justify-content-between align-items-center">
                    <a href="{% url 'blog:post_detail' featured_post.slug %}" class="btn btn-primary">Read Full Story</a>
                    <small class="text-body-secondary">{{ featured_post.likes }} likes</small>
                </div>
            </div>
        </div>
    </div>
    {% endif %}

    <!-- Regular Posts Grid -->
    <div class="row row-cols-1 row-cols-md-2 g-4">
        {% for post in posts %}
            <div class="col animate-on-scroll">
                <div class="card shadow-sm h-100">
                    {% if post.is_image %}
                        <a href="{% url 'blog:post_detail' post.slug %}"><img src="{{ post.thumbnail.url }}" alt="{{ post.title }}" class="card-img-top" style="height: 200px; object-fit: cover;"></a>
                    {% endif %}
                    <div class="card-body d-flex flex-column">
                        <h3 class="card-title h5"><a href="{% url 'blog:post_detail' post.slug %}" class="text-body text-decoration-none">{{ post.title }}</a></h3>
                        <p class="card-text text-body-secondary small">By <strong><a href="{% url 'blog:public_user_profile' post.author.username %}" class="text-body-secondary text-decoration-none">{{ post.author.username }}</a></strong> &middot; {{ post.created|date:"M d, Y" }} &middot; {{ post.content|calculate_reading_time }} min read</p>
                        <p class="card-text flex-grow-1">{{ post.content|striptags|truncatewords:15 }}</p>
                        <small class="text-body-secondary">{{ post.likes }} likes</small>
                    </div>
                </div>
            </div>
        {% empty %}
            {% if not featured_post %}
            <div class="alert alert-secondary animate-on-scroll">No posts have been published yet. Be the first to <a href="{% url 'blog:post_create' %}" class="alert-link">create one</a>!</div>
            {% endif %}
        {% endfor %}
    </div>

    {% if posts.has_other_pages %}
    <nav aria-label="Page navigation" class="mt-5">
        <ul class="pagination justify-content-center">
            {% if posts.has_previous %}
                <li class="page-item"><a class="page-link" href="?page={{ posts.previous_page_number }}">Previous</a></li>
            {% endif %}
            {% if posts.has_next %}
                <li class="page-item"><a class="page-link" href="?page={{ posts.next_page_number }}">Next</a></li>
            {% endif %}
        </ul>
    </nav>
    {% endif %}
{% endblock %}